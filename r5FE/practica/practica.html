<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <script src="js/libreria.js"></script>
        <script src="js/datos.js"></script>        
        <script src="js/info_acad.js"></script>
        <script src="js/exp_pro.js"></script>
        <script src="js/cursos_re.js"></script>
        <script src="js/idiomas.js"></script>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" lang="es-es">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <form >
            <fieldset>
                <legend>Datos Personales</legend>

                <label>Nombre y Apellidos<input id="nombre_y_ap" type="text"/></label>
                <label>Dirección<input type="text"/></label>


                <label>Ciudad<select id="ciudad"  onmouseout="carga_poblaciones();">
                        <option id="c1">Almería</option>          
                        <option id="c2">Granada</option>          
                        <option id="c3">Málaga</option>          
                    </select></label>
                <label>Población

                    <select id="select_poblaciones" onclick="escribe_cp();">

                    </select></label>
                <label>Código Postal<input id="cp" type="text"/></label>
                <label>Telefonos<input type="text"/></label>
                <label>Correo Electronico<input type="text"/></label>
                <label>Fecha de Nacimiento<input type="date" id="fnac"/></label>
                <label>Lugar de Nacimiento<input type="text" id="lnac"/></label>
                <label>Estado Civil
                    <select id="s_estado">
                        <option>Soltero</option>
                        <option>Casado</option>
                        <option>Separado</option>
                        <option>Viudo</option>
                    </select>
                </label>
            </fieldset>            
            <fieldset> 
                <!-sdfgsfgsdfgsg-->
                <legend>Información Académica</legend>
                <div>
                    <label>Nombre de la Institución<input id="nombre_acad" type="text"/></label>
                    <label>Titulo Obtenido<input id="titulo_obt" type="text"/></label>
                    <label>Fecha Comienzo<input id="fi_acad" type="date"/></label>
                    <label>Fecha Fin<input id="ff_acad" type="date"/></label>
                    <div>
                        <label>Comentarios</label></div>
                    <div>
                        <textarea rows="4" cols="50" id="coment_acad"></textarea>
                    </div>
                </div>                
                <button type="button" onclick="nuevo_merito()">Nuevo Merito</button>
                <button type="button" onclick="fvalida_info_acad()">Comprueba</button>
            </fieldset>
            <fieldset id="exp_prof">
                <legend >Experiencia Profesional</legend>
                <div>
                    <label>Empresa<input id="empresa" type="text"/></label>
                    <label>Puesto<input id="puesto" type="text"/></label>
                    <div>
                        <label>Fecha Inicio<input id="fi_exp" type="date"/></label>
                        <label>Fecha Fin<input id="ff_exp" type="date"/></label>
                    </div>
                    <div>
                        <label>Descripcion del Puesto
                            <input id="desc_puesto_exp" type="text"/></label></div>
                    <div>
                        <label>Tareas Realizadas</label></div>
                    <div>
                        <textarea rows="4" cols="50" id="tareas_r_exp" ></textarea>
                    </div>                    
                    <label>Logros Conseguidos</label>
                    <div>
                        <textarea rows="4" cols="50" id="logros_exp"></textarea>
                    </div>
                    <button type="button" onclick="nueva_exp_prof();">Nueva experiencia</button>
                    <button type="button" onclick="f_validar_exp();">Comprueba</button>
            </fieldset>
            <fieldset id="cr">
                <legend>Cursos Realizados</legend>
                <div>
                    <label>Nombre<input id="nombre_curso" type="text"/></label>
                    <label>Institución<input id="inst_curso" type="text"/></label>
                    <div>
                        <label>Fecha Inicio<input id="fi_curso" type="date"/></label>
                        <label>Fecha Fin<input id="ff_curso" type="date"/></label>
                    </div>
                    <label>Titulo Obtenido<input id="to_curso" type="text"/></label>
                </div>
                <button type="button" onclick="nuevo_curso();" >Nuevo curso</button>
                <button type="button" onclick="f_validar_cursos();">Comprueba</button>
            </fieldset>

            <fieldset id="fidimoas" >
                <legend id="s_idiomas" >Idiomas</legend>
                <div>
                    <label>Idioma</label>
                    <select id="idioma" >                       
                    </select>
                    <label>Nivel</label>
                    <select  id="nivel_idioma">                        
                    </select>
                </div>
                <button type="button" onclick="nuevo_idioma();">Nuevo Idioma</button>
                <button type="button" onclick="f_validar_idm();">Comprueba</button>
            </fieldset>
            <fieldset>
                <legend>Conocimientos adicionales</legend>
                <label>Descripcion</label>
                <div><textarea  rows="8" cols="100"></textarea></div>
            </fieldset>
            <fieldset>
                <legend>Hobbies y actividades de interés particulares</legend>

                <label>Descripcion</label>
                <div><textarea rows="8" cols="100"></textarea></div>
            </fieldset>
            <fieldset>
                <legend>Carta de Presentación</legend>
                <input id="fichero" type="file" onchange="processFiles(this.files);"/>
                <div>
                    <textarea  id="contenido_fichero" rows="8" cols="100"></textarea></div>
            </fieldset>
            <button type="button" onclick="valida_datos_personales()"  ></button>
        </form>
        <script>

            function f_validar_idm()
            {
                var v = new Array();
                v.push(is_select_selected(document.getElementById("idioma")));
                v.push(is_select_selected(document.getElementById("nivel_idioma")));
                var campos = ["Idioma",
                    "Nivel"];
                var cadena = "";
                for (var i = 0; i < campos.length; i++)
                {
                    cadena = cadena + "\n" + campos[i] + " " + v[i];
                }
                alert(cadena);
            }


            function f_validar_cursos()
            {
                var v = new Array();
                v.push(validar_nombres(document.getElementById("nombre_c").value));
                v.push(validar_nombres(document.getElementById("inst_c").value));
                var f1 = document.getElementById("fi_c").value;
                var f2 = document.getElementById("ff_c").value;
                //alert(f1);
                v.push(validar_intervalo_fechas(f1, f2));
                v.push(no_es_vacio(document.getElementById("tit_curso").value));

                var campos = ["Nombre Curso",
                    "Institución",
                    "Fechas de Comienzo y de Fin",
                    "Titulo Obtenido"];
                var cadena = "";
                for (var i = 0; i < campos.length; i++)
                {
                    cadena = cadena + "\n" + campos[i] + " " + v[i];
                }
                alert(cadena);
            }

            function f_validar_exp()
            {
                var v = new Array();
                v.push(validar_nombres(document.getElementById("empresa").value));
                v.push(validar_nombres(document.getElementById("puesto").value));
                var f1 = document.getElementById("fi_exp").value;
                var f2 = document.getElementById("ff_exp").value;
                //alert(f1);
                v.push(validar_intervalo_fechas(f1, f2));
                v.push(true);
                v.push(true);


                v.push(true);

                var campos = ["Empresa",
                    "Institución",
                    "Fechas de Comienzo y de Fin",
                    "Descripcion puesto", "Tareas Realizadas", "Logros Conseguidos"];
                var cadena = "";
                for (var i = 0; i < campos.length; i++)
                {
                    cadena = cadena + "\n" + campos[i] + " " + v[i];
                }
                alert(cadena);
            }

            function validar_nombres(v)
            {
                if (/\D+/.test(v))
                {
                    return true;
                }
                return false;
            }

            function validar_direccion(v)
            {
                if (/\w+/.test(v))
                {
                    return true;
                }
                return false;
            }

            function validar_lugar_nacimiento(v)
            {
                return valida_fecha(v);
            }

            function validaTelefono(valor)
            {
                if (/(\+?\d{2,3})?(\d{3}-\d{6})/.test(valor) || /(\+?\d{2,3})?(\d{9})/.test(valor))
                {

                    return true;
                }

                return false;
            }

            function validar_correo_electronico(v)
            {

                if ((/\w+[^+/%&]@\w+[^+/%&]\.\w{3}/.test(v)))
                {
                    //alert ('bueno');
                    return true;
                }
                //alert ('malo');
                return false;
            }


            function validar_estado_civil()
            {
                var s = document.getElementById("s_estado");
                return is_select_selected(s);

            }

            function validar_intervalo_fechas(f1, f2)
            {
                alert(f1.length + " " + f2.length);
                alert(f1 + " " + f2);
                if ((f1.length !== 0) && (f2.length !== 0))
                {
                    alert("ok1");
                    if (navigator.userAgent.indexOf("Chrome") !== -1)
                    {
                        alert("ok2");
                        var c1 = f1.split("-");
                        f1 = c1[2] + "/" + c1[1] + "/" + c1[0];
                        alert(f1);
                        var c2 = f2.split("-");
                        f2 = c2[2] + "/" + c2[1] + "/" + c2[0];
                        alert(f2);
                    }

                    var ff1 = new Date(c1[2], c1[1], c1[0]);

                    var ff2 = new Date(c2[2], c2[1], c2[0]);
                    //alert(ff1.toString() + " " + ff2.toString());

                    if (ff1 < ff2)
                    {
                        //alert('buena');
                        return true;
                    }
                }
                return false;
            }

            function fvalida_info_acad()
            {

                var v = new Array();
                v.push(validar_nombres(document.getElementById("nombre_acad")));
                v.push(validar_nombres(document.getElementById("titulo_obt")));
                var f1 = document.getElementById("fi_acad").value;
                var f2 = document.getElementById("ff_acad").value;
                v.push(validar_intervalo_fechas(f1, f2));


                v.push(true);

                var campos = ["nombre de la Institución",
                    "Titulo Obtenido",
                    "Fechas de Comienzo y de Fin",
                    "Comentarios"];
                var cadena = "";
                for (var i = 0; i < campos.length; i++)
                {
                    cadena = cadena + "\n" + campos[i] + " " + v[i];
                }
                alert(cadena);
            }

            function fvalida_datos_personales()
            {
                var v = new Array();

                v.push(validar_nombres(document.getElementById("nombre_y_ap").value));//
                v.push(validar_direccion());//
                v.push(validaTelefono());//
                v.push(validar_correo_electronico());
                v.push(valida_fecha_nacimiento(document.getElementById("fnac").value));//
                v.push(validar_lugar_nacimiento());//

                //v.push(validar_estado_civil());

                var campos = ["nombre", "direccion", "telefono", "correo", "fecha", "lugar de nacimiento", "estado civil"];

                var cadena = "";
                for (var i = 0; i < campos.length; i++)
                {
                    cadena = cadena + "\n" + campos[i] + " " + v[i];
                }
                alert(cadena);
            }

            function comprobar_si_f_actual_menor_f_nacimiento(fecha)
            {
                var fecha;
                //alert(fecha)
                if (navigator.userAgent.indexOf("Chrome") !== -1)
                {
                    var cadena = fecha.split("-");
                    fecha = cadena[2] + "/" + cadena[1] + "/" + cadena[0];
                }

                fecha = new Date(fecha);

                var f_hoy = new Date();


                if (fecha < f_hoy)
                {
                    alert('buena');
                    return true;
                } else
                {
                    alert('mala');
                    return false;
                }
            }

            function valida_fecha_nacimiento(cad_fecha)
            {
                var fecha = cad_fecha;

                //var fecha = document.getElementById("f_nac").value;
                if (comprobar_si_f_actual_menor_f_nacimiento(cad_fecha))
                {
                    fecha = cad_fecha;
                    //fecha="01/01/2001";
                    //alert(fecha);
                    //if((/\d{1,2}\/\d{1,2}\/\d{4}/.test(fecha)))
                    if (navigator.userAgent.indexOf("Chrome") !== -1)
                    {
                        //alert("Estas usando Chrome y la fecha deberia ser probada con Firefox");
                        var cadena = fecha.split("-");
                        fecha = cadena[2] + "/" + cadena[1] + "/" + cadena[0];

                    } else
                    {
                        //if (navigator.userAgent.indexOf("Firefox") !== -1)
                    }
                    if ((/\d{1,2}\/\d{1,2}\/\d{4}/.test(fecha)))
                    {
                        var cadena = fecha.split("-");
                        var d = Number(cadena[0]);
                        var m = Number(cadena[1]);
                        var y = Number(cadena[2]);
                        if (!(d < 0 || d > 31 || m < 1 || m > 12 || y < 0))
                        {
                            return true;
                        }
                    }
                }
                //alert('malo');
                return false;
            }

            function borra_poblaciones()
            {
                var select = document.getElementById("select_poblaciones");
                //var options=select.getElementsByTagName("option");
                //alert ("Elementos con tag option en select de poblaciones :"+options.length);


                while (select.hasChildNodes())
                {
                    select.removeChild(select.firstChild);
                }
                //alert ("option"+options.length);
            }

            function escribe_cp()
            {
                var caja = document.getElementById("cp");
                var select = document.getElementById("select_poblaciones");
                var options = select.getElementsByTagName("option");
                //alert (options.length);
                var i = 0;
                while (options[i].selected !== true)
                    i++;

                var v = cargar_codigos_postales(recupera_ciudad());
                //alert(vcp[n].split(":")[0]);
                //caja.innerHTML=vcp[n].split(":")[0];
                caja.value = v[options[i].value].split(":")[0];
                //alert(event.type);
            }

            function carga_poblaciones()
            {
                var select = document.getElementById("select_poblaciones");
                borra_poblaciones();
                var element;
                var ciudad = recupera_ciudad();
                //alert(recupera_ciudad());
                var cpob = cargar_codigos_postales(ciudad);
                // alert (cpob);
                for (var i = 0; i < cpob.length; i++)
                {
                    element = document.createElement("option");

                    element.value = i;
                    element.innerHTML = cpob[i].split(":")[1];

                    //element.addEventListener("onselect", "escribe_cp();", true);
                    select.appendChild(element);
                }
                //alert("Número de inserciones :"+cpob.length);
            }

            function recupera_ciudad()
            {
                var c1 = document.getElementById("c1");
                var c2 = document.getElementById("c2");
                var c3 = document.getElementById("c3");
                if (c1.selected === true)
                {
                    return c1.innerHTML;
                }
                if (c2.selected === true)
                {
                    return c2.innerHTML;
                }
                if (c3.selected === true)
                {
                    return c3.innerHTML;
                }

            }
            
           carga_idiomas();
           carga_niveles();
        </script>
    </body>
</html>
